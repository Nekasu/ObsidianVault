## 基于图像预处理的解决方案与分析

### 解决方案 1：填充

#### 解决方案 1 的描述

1. 解决方案：纹理填充
	1. 既然网络将『风格主体图』与『风格背景图』中白色的部分当成了风格的一部分, 那么我们可以考虑将其中非白色的真正风格部分填充到整个图像上, 以减轻或避免白色或透明背景带来的影响.

#### 解决方案 1 的结果展示

进行填充后的图像如下图所示, 请根据图例进行阅读, 为了节省时间就不过多赘述

![](https://raw.githubusercontent.com/Nekasu/Blog_pics/main/20240612201347.png)

#### 解决方案 1 的结果分析

1. 风格迁移结果较上次来说, 有一定的提升, 但是依旧存在问题. 由于使用纹理填充的方法依旧会在风格图中留下小部分的白色间隙, 如下图红框中的部分
	1. ![](https://raw.githubusercontent.com/Nekasu/Blog_pics/main/20240614101628.png)
	2. 该部分往往会被 AesFA 认为成风格, 并在风格迁移过程中将上面这种重复出现的白色间隙当作风格的一部分. 
	3. 为了解决这个问题, 我们需要消除风格图像中的白色部分. 
		1. 根据杨欢同学的提示, 我们可以将风格图像中白色的部分变成黑色. 因为他说, “图像中黑色部分的数值为 0 , 而 0 与任何数值的计算均为 0”. 通过这种方法应该可以获得较好的效果.
		2. 以这种方法为基础, 我们进行该想法的实验

### 解决方案 2：黑底

#### 解决方案 2 的描述

在[[风格迁移层面的问题#解决方案 1 的结果分析]]的最后有相关描述, 此处进行简单摘录：

1. 将风格图像中白色的部分变成黑色, 再进行风格迁移

#### 解决方案 2 的结果展示

![](https://raw.githubusercontent.com/Nekasu/Blog_pics/main/20240618145024.png)

#### 解决方案 2 的结果分析

结果与[[风格迁移层面的问题#问题描述]]类似, 但也存在一定区别：

1. 原始问题中, 风格图像会跑到主体图像外部, 而解决方案 2 中的结果显示, 不会出现风格溢出到背景中的问题
2. 本方法对一些以黑色为主体的图像较为友好, 如 cameraman 图像的风格迁移结果 ([[风格迁移层面的问题#解决方案 2 的结果展示]]中最后一行)中, 其黑色的衣服与黑色的摄影竿被很好的保留的效果.


### 解决方案 3：黑底填充

#### 解决方案 3 的描述

1. 解决方案：黑色背景的纹理填充
	1. 将[[风格迁移层面的问题#解决方案 2]] 与[[风格迁移层面的问题#解决方案 1]] 结合
	2. 将方案 1 中的白色背景变成黑色的背景. 并再次迁移.

#### 解决方案 3 的结果展示

![](https://raw.githubusercontent.com/Nekasu/Blog_pics/main/20240618210024.png)

#### 解决方案 3 的结果分析

可以发现, 经过 AesFA 处理后的『风格主体图』与原『风格主体图』相比, 为暗色调为主要部分的图像加上了<mark style="background: #6495EDED;">白色描边</mark>. 

经过实验发现, 

实际上, 风格图像也有一些问题：明明是黑色背景的图像, 但是依旧有一些褐色背景的存在, 如下图

![|203](https://raw.githubusercontent.com/Nekasu/Blog_pics/main/20240618160346.png)

- [x] 使用抠图的方法解决该问题, 并请重新进行实验.
	- 通过以下两种方法解决
		- 使用 PS 抠图解决原始风格图像中的白色背景部分
		- 通过修改 AesFA 读入图像的代码解决, 在读图像时直接将透明背景转成白色
	- 结果：没什么影响, 在 test 文件中, 可能是在 do_transform 时的 resize 操作与 normalize 操作导致了风格图像中白色部分的放大, 结果详情见 test 5
- [ ] 下面测试 do_transform 函数中, 哪一部分导致了『风格主体图』中白色轮廓的出现与扩大
	- 测试说明：
		- 为防止修改 `do_transform()` 后导致的风格迁移程序出错, 所以仅保存该函数的结果作为研究
	- 测试信息：
		- 使用图像路径：
			- `/mnt/sda/zxt/3_code_area/code_papers/AesFA/img/birds_main_multi_black/birds_main_multi_black.png`
		- 使用图像展示：
			- ![|266](https://raw.githubusercontent.com/Nekasu/Blog_pics/main/20240619160734.png)
			- 即本解决方案结果展示部分最左侧的图像
	- 测试结果：
		- 实际上，是我的图像出现了问题, 将上述测试图像拖入 csp 中可以发现变成如下
		-  ![|396](https://raw.githubusercontent.com/Nekasu/Blog_pics/main/20240619160932.png)
		- 存在大量的透明或近似透明的背景, 所以是本人操作的失误, 重新编写函数 `transparent.py->make_transparent_black` 后重新进行实验.
		- 图像的α通道的值在 0~255 之间, 上述白色的部分就是这些近似透明的部分

#### 解决方案 3 的改进

由于图像 alpha 通道的取值范围为\[0,255\], 有些像素就是白色, 且具有较高的不透明度

而本人编写的函数 `transparent.py->make_transparent_black` 在将透明背景转换成不透明的黑色时, 仅仅考虑的不透明度为 0 的那些像素, 而未考虑那些低不透明度、且颜色偏白的图像.

现将不透明度<200 的所有像素变成黑色, 并进行初步实验, 以检查结果

结果如下：

![](https://raw.githubusercontent.com/Nekasu/Blog_pics/main/20240619193002.png)

可以发现,  结果依旧不好. 与[[风格迁移层面的问题#解决方案 3 的结果展示]]中的结果相比, 白色的小点虽然消失不见, 但取而代之的是一些黑色的小点

还是考虑修改神经网络, 让神经网络不处理透明像素的部分吧, 具体可以看[[风格迁移层面的问题#深入神经网络思考修改网络模块]]

### 解决方案 4：丢弃

#### 解决方案 4 的描述

实际上, 往往是『风格主体图』中, 存在少量『风格背景图』的颜色, 从而导致了『内容主体图』在风格迁移的时候可能存在如[[风格迁移层面的问题#解决方案 1 的结果展示]]中的白色块.

- 而我们可以进行如下猜测, 即使少了风格主体, 也不会对风格迁移的过程产生过多的影响 (猜测). 
- 所以我们可以考虑丢弃『风格主体图像』中与背景颜色类似的部分, 
	- 我们称这部分为『风格主体噪声部分』.
	- 去除『风格主体噪声部分』后, 再进行风格迁移

1. 有两处可以去除『风格主体噪声部分』
	1. 其一为图像预处理阶段, 对分离后的『风格主体图』进行该操作, 称为操作 1
		1. 再使用[[风格迁移层面的问题#解决方案 3]] 中的黑色背景纹理重复, 
		2. 再进行风格迁移 
	2. 其二为神经网络迁移阶段, 对使用 `do_tranform()` 后的『风格主体图』进行该操作, 称为操作 2
		1. 再送入神经网络进行风格迁移
2. 将以上两处排列组合, 可以得到 $C_2^1+C_2^2=3$ 种不同的解决策略
	1. 其一为仅使用操作 1
	2. 其二为仅使用操作 2
	3. 其三为使用操作 1 与操作 2 的结合

下面分开进行实验

#### 仅使用操作 1

##### 解决方案 4、仅使用操作 1 的结果展示

##### 解决方案 4、仅使用操作 1 的结果分析

#### 仅使用操作 2

##### 解决方案 4、仅使用操作 2 的结果展示

##### 解决方案 4、仅使用操作 2 的结果分析

#### 结合操作 1 与操作 2

##### 解决方案 4、结合操作 1 与操作 2 的结果展示

##### 解决方案 4、结合操作 1 与操作 2 的结果分析


#### 解决方案 4 的结果分析
