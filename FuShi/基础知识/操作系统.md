# 进程与线程

## 基本概念

1. 进程是某个程序在一个数据集上的一次运行活动, 是系统调度的基本单位
2. 线程是CPU调度的基本单位

## 两者关系

1. 线程和线程: 一个线程可以创立和撤销另一个线程
2. 进程与线程: 一个进程中可以包含多个线程
3. 线程与进程: 一个进程中可以有多个线程并发执行

## 进程的状态

1. 创建态: 进程的创建过程, 申请PCB并将PCB放入就绪队列的状态
2. 就绪态: 进程已经处于可以上cpu运行的阶段, 仅仅需要等待cpu的调度, 进程创建和时间片用完时, 进程会进入就绪态
3. 运行态: 进程已经获得cpu的状态, 正在运行中
4. 阻塞态: 正在运行的进程由于某些原因, 如IO请求, 导致失去cpu资源无法继续运行的状态
5. 终止态: 进程运行结束后, 系统回收PCB等资源, 销毁进程的状态

## 进程的调度算法

### 进程调度的六种算法

1. 先来先服务
2. 短作业优先算法
3. 时间片轮转调度算法
4. 高相应比优先: 相应比$=(已等待时间+要求运行时间)/要求运行时间$ 
5. 优先级调度算法: 按照设定的优先级调度进程, 优先级越高的越先调度
6. 多级队列调度算法

### 两种方式

1. 抢占式调度
2. 非抢占式调度


# 死锁

## 什么是死锁


两个或多个并发进程中, 如果每个进程都持有某种资源并在等待其他进程释放自己的资源而导致的进程工作无法推进的状态

通俗来说, 就是两个或多个进程无限期被阻塞, 相互等待的状态

### 死锁产生的必要条件

1. 两个资源条件
	1. 资源互斥
		- 每个资源只能被一个进程拥有
	2. 不可剥夺
		- 在一个进程获得资源后, 使用结束前, 其他进程不可剥夺该资源
2. 两个进程条件
	1. 请求和保持请求
		- 一个进程已经有了部分资源, 但提出了新的资源请求
		- 一个进程在等待其他资源时, 不是放自己的资源
	2. 循环等待
		- 多个进程形成环状, 相互等待彼此的资源

# 进程间通信

进程间通信有三种方式

## 共享存储

用一个两个程序都可以访问的空间放共享信息

1.  原本: 各个进程仅能访问自己的内存空间
2.  但是: 可以申请一个共享存储区, 多个进程可以一起访问这个存储空间
	-   注意! 是一起访问, 不是同时访问! 不可以同时访问!
3. 分类
	-   基于存储区的共享(高级)
		-   进程可以控制共享区, 放自己想放的数据
	-   基于数据结构的共享(低级)
		-   由操作系统控制共享区, 指定该区域只能放特定类型的数据(如数组)

## 消息传递

发消息给邮箱或者直接给另一个进程

1.  基本概念: 进程的数据交换以格式化信息为单位. 通过操作系统的提供的"发送/接收"消息的两个原语进行数据交换
2.  分类
	1.  直接通信方式: 消息头中会指明需要发送到的进程的pid
		-   现假设进程P向进程Q发送消息,
		-   Q的PCB中存在一个消息队列, 这个消息队列中存放着需要Q接受的消息
		-   以下是接受步骤
			1.  进程P完善自己的消息, 并使用send原语发送给操作系统
			2.  操作系统在捕获后, 将上述信息挂载在Q的消息队列中
			3.  进程Q接收到P发送的消息
	2.  间接通信方式
		-  现假设进程P向进程Q发送消息, 以下是操作过程
			1.  进程P向系统申请一个邮箱A, 在P进程中初始化信息, 指明需要发送到的邮箱A
			2.  进程B向信箱A中获取信息, 完成通信

## 管道通信

先进先出, 读出即消失

 管道实际上就是一个特殊的共享文件, 其实就是在存储中开辟一个固定大小的内存缓冲区.  其特点是先进先出, 通讯过程如下
 1.  进程P完善需要发送的信息, 并发送到管道文件中
 2.  进程Q以先进先出的方式, 从管道文件中取出信息

 ### 特点
-   单个管道通信只能实现半双工通信, 及某一时间段内只能实现单向传输;
	-   若要实现全双工通信, 则需要设置两个管道
-   当管道写满时, 写进程讲阻塞.  当管道为空时, 读进程阻塞
-   管道中的数据一旦被读出, 就彻底消失;
	-   因此多个读进程同时都读一个管道时, 可能会错乱
	-   一个管道仅仅允许多个写进程, 一个读进程


# 进程的同步与互斥

## 什么是同步什么是互斥

1. 同步: 用于描述两个进程之间运行的前后顺序的关系
2. 互斥: 两个进程相互独立的访问资源, 互不影响

## 实现互斥的原则

1. 忙则等待
2. 空闲让进
3. 有限等待
4. 让全等待

## 实现互斥的方法

### 软件实现互斥

1. 单标志法
	1. 要求两个进程交替执行
	2. 如何一个进程停止运行, 那么另一个也无法继续运行, 无法做到空闲让进
2. 双标志法
	1. 双标志法先检验
		1. 先将自己需要的资源获取, 再检验是否可获取, 可能导致两个进程同时访问一个资源, 无法做到"忙则等待"
	2. 双标志法后检验
		1. 先检查即将申请的资源是否可用, 如果可用则获取, 可能导致两个进程同时等待资源, 无法做到"空闲让进"
3. Peterson算法
	- 基本步骤
		-   先表明需要该资源
		-   并表示谦让
		-   如果对方想要且表示了谦让, 则本进程等待
		-   否则使用资源
		-   使用完毕后释放资源, 表示已经用完
4. 信号量机制
	1. P操作
		- P操作表示申请操作, 想用什么之前先P一下, 也可用于表示消费了什么
	2. V操作
		- V操作表示释放操作, 用完什么了V一下, 也可用于表示产生了什么
5. 管程


# 操作系统的四个基本特征

1. 共享
	1. 系统中的资源可以供多个进程使用
2. 并发
	1.  并发: 微观上交替发生, 宏观上同时发生
	2.  并行: 同时发生
3. 虚拟
	- 把一个物理上的实体变为若干个逻辑上的对应物
	- 用户能够感受到有多个实体的存在, 但实际上只有一个
4. 异步
	1. 走走停停

# 分段与分页

## 分段与分页的区别

1. 概念上的区别
	1. 分页更多的是一个物理概念, 它将内存和进程划分成了多个相同大小的块
	2. 分段更多的是一个逻辑概念, 它是一段程序在逻辑功能上的划分
2. 大小的不同
	1. 页面大小主要有系统决定, 一个系统的页面大小往往是固定的
	2. 段的大小可以改变, 主要按照程序编写的逻辑段划分
3. 实现上不同
	1. 虽然都有基本寻址机构, 但是他们的逻辑地址和地址变换机构的作用方法不同
		1. 分页式的逻辑地址中只有页号和页内地址
		2. 分段式的逻辑地址中有段号, 段长和段内地址
		- 这是由于分页的大小都相同的, 而分段的大小不同导致的

## 页面置换算法

1. 最佳置换算法
2. 先进先出算法
3. 最近最久未使用算法: 需要替换页面时, 将未使用时间最长的调出
4. 最少使用置换算法: 需要页面替换时, 将最近使用次数最少的调出
5. CLOCK算法
	1. 将所有内存中的页面通过指针等方式连接起来
	2. 每一页具有访问位, 当该页被调用时, 访问位置为1
	3. 循环搜索, 搜索时如果该页的访问位为1, 则置为0
	4. 如果该页的访问位为0, 则调出

# 同步与异步

![[操作系统#什么是同步什么是互斥]]

![[操作系统#操作系统的四个基本特征]]

# 置换算法

## 进程调度算法

![[操作系统#进程调度的六种算法]]

## 页面置换算法

![[操作系统#页面置换算法]]
